<!DOCTYPE html>
<html lang="en">
    
<head >
    <title>Jump Jump</title>
    <meta charset="utf-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" /> -->
    <link rel="stylesheet" href="css/zjreplay.css">

</head>

<script src="build/three.js"></script>
<script src="js/WebGL.js"></script>
<script src="js/Stats.js"></script>
<script src="js/tween.min.js"></script>
<script src="js/play/createBox.js"></script>
<script src="js/play/showVideo.js"></script>

<script src="js/config.js"></script>
<script src="js/flexible.js"></script>
<!-- <script src="jquery/jquery-3.3.1.js"></script> -->
<!-- <script src="js/controls/OrbitControls.js"></script> -->

<script>
    document.oncontextmenu=function(e){
        //或者return false;
        e.preventDefault();
    };

    if ( WEBGL.isWebGLAvailable() === false ) {
    document.body.appendChild( WEBGL.getWebGLErrorMessage() );
    }
    
    // var camera,  scene, controls, renderer;
    var camera,  scene, renderer;
    var stats;

    function threeStart() {
        init();
        animate();
    }

    var player;
    var point = 0;
    var direction = 1; //1right 0left

    var playerPosition;
    var jumpDistance, buildDistance;
    var downtween;
    var mainmesh1,mainmesh2,mainmesh3,mainmesh4,mainmesh5;
    var mainmeshPosition1,mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5;
    var LUCKY_TYPE = {
        MONEY: 1,
        RECORD: 2,
    }

    function init() {

        scene = new THREE.Scene();
        scene.background = new THREE.Color( 0x8797a4 );

        width = document.getElementById('canvas-frame').clientWidth;
        height = document.getElementById('canvas-frame').clientHeight;

		
        renderer = new THREE.WebGLRenderer({ antialias: true } );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize(width, height );
        renderer.shadowMap.enabled = true;
        document.getElementById('canvas-frame').appendChild( renderer.domElement );

        stats = new Stats();
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.right = '8px';
        stats.domElement.style.top = '8px';
        stats.domElement.style.width = '90px';
        // document.getElementById('canvas-frame').appendChild( stats.domElement );
 
        var ratio = width >= 375 ? 2 : 1
        camera = new THREE.OrthographicCamera( width / - ratio, width / ratio, height / ratio, height / - ratio, -1000, 2000 );
        camera.position.set( 200 , 165 , 150 );
        camera.lookAt(new THREE.Vector3(0,0,0));

        // controls = new THREE.OrbitControls( camera, renderer.domElement );
        // //controls.addEventListener( 'change', render ); // call this only in static scenes (i.e., if there is no animation loop)
        // controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
        // controls.dampingFactor = 0.25;
        // controls.screenSpacePanning = false;
        // controls.minDistance = 100;
        // controls.maxDistance = 500;
        // controls.maxPolarAngle = Math.PI / 2;

        light = new THREE.AmbientLight( 0xFFFFFF,0.7);
        scene.add( light );
        // light3 = new THREE.DirectionalLight( 0xFFFFFF,0.2);
        // // light2.position.set(0,400,0);
        // scene.add( light3 );

        light2 = new THREE.DirectionalLight(0xFFFFFF,0.4);
        light2.castShadow = true;//开启灯光投射阴影
        light2.position.set(300,400,0);
        // light2.onlyShadow = true;
        light2.shadowDarkness = 0.6;
        light2.shadow.mapSize.width = 2000;  // default 512
        light2.shadow.mapSize.height = 2000 ; // default 512
        light2.shadow.camera.near = 300;    // default 0.5
        light2.shadow.camera.far = 700;     // default 500
        light2.shadow.camera.left = -500;
        light2.shadow.camera.right = 500;
        light2.shadow.camera.top = 500;
        light2.shadow.camera.bottom = -500;
        // var helper = new THREE.CameraHelper( light2.shadow.camera );
        // scene.add( helper );

        var ground = creatGround(0,0,0x8797a4);
        var boxNum = Math.floor(Math.random()*9); //0~boxCount-1
        switch(boxNum)
        {
            case 0:mainmesh4 = creatcube10(0,0);break;
            case 1:mainmesh4 = creatcube11(0,0);break;
            case 2:mainmesh4 = creatcube12(0,0);break;
            case 3:mainmesh4 = creatcube13(0,0);break;
            case 4:mainmesh4 = creatcube14(0,0);break;
            case 5:mainmesh4 = creatcube15(0,0);break;
            case 6:mainmesh4 = creatcube16(0,0);break;
            case 7:mainmesh4 = creatcube17(0,0);break;
            case 8:mainmesh4 = creatcube18(0,0);break;
        }
        mainmeshPosition4= new THREE.Vector3(0,0,0);
        buildDistance = 200;
        var boxNum = Math.floor(Math.random()*9); //0~boxCount-1
        switch(boxNum)
        {
            case 0:mainmesh5 = creatcube10(0,-buildDistance);break;
            case 1:mainmesh5 = creatcube11(0,-buildDistance);break;
            case 2:mainmesh5 = creatcube12(0,-buildDistance);break;
            case 3:mainmesh5 = creatcube13(0,-buildDistance);break;
            case 4:mainmesh5 = creatcube14(0,-buildDistance);break;
            case 5:mainmesh5 = creatcube15(0,-buildDistance);break;
            case 6:mainmesh5 = creatcube16(0,-buildDistance);break;
            case 7:mainmesh5 = creatcube17(0,-buildDistance);break;
            case 8:mainmesh5 = creatcube18(0,-buildDistance);break;
        }
        mainmeshPosition5= new THREE.Vector3(0,0,0);
        player = creatcubeplayer(0,-50,0);
        player.position.set(0,200,0);
        playerPosition = new THREE.Vector3(0,0,0);
        // var playerHelper = new THREE.BoxHelper( player );
        // scene.add( playerHelper );
        scene.add(player);  
        // console.log(player);
        // light2.target = player.children[1];
        scene.add(light2);

        var Option = { py: player.position.y};
        new TWEEN.Tween(Option)
                        .to({
                            py: 50,
                        },500)
                        .onUpdate(function() {
                            player.position.y = this.py;
                        })
                        .onComplete(function() {

                            var flag = IsPC(); 
                            // console.log(flag)//true为PC端，false为手机端和ipad

                            if (flag == true){
                                var downTime = 0;
                                document.getElementById("canvas-frame").addEventListener("mousedown", function(){
                                    document.getElementById('audio').pause();
                                    // console.log(buildDistance);
                                    beStronger();
                                    bulingBulingDown();  
                                    var now = new Date();
                                    downTime = now.getTime();
                                });
                                document.getElementById("canvas-frame").addEventListener("mouseup", function(){                   
                                    downtween.stop();
                                    var now2 = new Date();
                                    upTime = now2.getTime();
                                    jumpDistance = Math.ceil((upTime - downTime)/100)==1? 20:100+Math.round((upTime-downTime)/100)*20;
                                    // console.log(jumpDistance);
                                    jump(jumpDistance);
                                });
                            } 
                            else {
                                document.getElementById("canvas-frame").addEventListener("touchstart", function(){
                                    document.getElementById('audio').pause();
                                // console.log(buildDistance);
                                    beStronger();
                                    bulingBulingDown();  
                                    var now = new Date();
                                    downTime = now.getTime();
                                });
                                document.getElementById("canvas-frame").addEventListener("touchend", function(){                   
                                    downtween.stop();
                                    var now2 = new Date();
                                    upTime = now2.getTime();
                                    jumpDistance = Math.ceil((upTime - downTime)/100)==1? 20:100+Math.round((upTime-downTime)/100)*20;
                                    // console.log(jumpDistance);
                                    jump(jumpDistance);
                                });
                            }                   

                        })
                        .easing(TWEEN.Easing.Bounce.Out) 
                        .delay(500)
                        .start();   

        window.addEventListener( 'resize', onWindowResize, false );
    }

    function IsPC() {
        var userAgentInfo = navigator.userAgent;
        var Agents = ["Android", "iPhone",
                    "SymbianOS", "Windows Phone",
                    "iPad", "iPod"];
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) {
                flag = false;
                break;
            }
        }
        console.log(flag)
        return flag;
    }

    function beStronger() {    
        Option = { py: player.children[0].position.y,sy: player.children[1].scale.y,sx: player.children[1].scale.x,sz: player.children[1].scale.z,};
        downtween = new TWEEN.Tween(Option)
                        .to({
                            py: 36,
                            sy: 0.5,
                            sx: 1.5,
                            sz: 1.5,
                        },1050)
                        .onUpdate(function() {
                            player.children[0].position.y = this.py;
                            player.children[1].scale.y = this.sy;
                            player.children[1].scale.x = this.sx;
                            player.children[1].scale.z = this.sz;
                        })
                        .interpolation( TWEEN.Interpolation.Bezier )
                        .start();
    }

    function jump(playerMoveLen) {
        if (direction == 1) {
            Option = { hpy:player.children[0].position.y,hsy:player.children[1].scale.y,hsx:player.children[1].scale.x,hsz:player.children[1].scale.z};
            jumpr1 = new TWEEN.Tween(Option)
                            .to({
                                hpy:56,
                                hsy:1,
                                hsx:1,
                                hsz:1,
                            }, 50)
                            .onUpdate(function() {
                                player.children[0].position.y = this.hpy;
                                player.children[1].scale.y = this.hsy;
                                player.children[1].scale.x = this.hsx;
                                player.children[1].scale.z = this.hsz;
                            })
            
            Option = { px:playerPosition.x ,py:0,pz:playerPosition.z};

            jumpr2 = new TWEEN.Tween(Option)
                            .to({
                                px:[playerPosition.x*0.5,0],
                                py: [150, 0],
                                pz: [playerPosition.z-playerMoveLen*0.5,playerPosition.z-playerMoveLen],
                                // rz: [Math.PI, 0],
                            }, 400)
                            .onUpdate(function() {
                                player.position.x = this.px;
                                player.position.y = this.py+50;
                                player.position.z = this.pz;
                            })
                            .onComplete(function() {
                                playerPosition.x = 0;
                                playerPosition.z = playerPosition.z -playerMoveLen;
                                if(-playerPosition.z-buildDistance<=50&&-playerPosition.z-buildDistance>=-50){
                                    // 下个盒子上
                                    pointGet();
                                    changeCamera();
                                    bulingBulingUp();
                                    // console.log("下个盒子上");
                                    
                                }
                                else if(-playerPosition.z<=50){
                                    //本盒子上
                                    bulingBulingUp();
                                    // console.log("本盒子上");
                                    
                                }
                                else if(-playerPosition.z>50&&-playerPosition.z<62){
                                    //本盒子边上掉落
                                    gameOver(11);
                                    // console.log("本盒子边上掉落");
                                }
                                else if(-playerPosition.z-buildDistance<62&&-playerPosition.z-buildDistance>50){
                                    //下个盒子远边上掉落
                                    gameOver(22);
                                    // console.log("下个盒子远边上掉落");
                                }
                                else if(-playerPosition.z-buildDistance>-38&&-playerPosition.z-buildDistance<-50){
                                    //下个盒子近边上掉落
                                    gameOver(21);
                                    // console.log("下个盒子近边上掉落");
                                }
                                else{
                                    //竖直下落
                                    gameOver(0);
                                    // console.log("竖直下落");
                                }
                            
                            })  
                            .interpolation( TWEEN.Interpolation.Bezier )
            jumpr1.chain(jumpr2);
            jumpr1.start();
        } 
        else {
            Option = { hpy:player.children[0].position.y,hsy:player.children[1].scale.y,hsx:player.children[1].scale.x,hsz:player.children[1].scale.z};
            jumpr1 = new TWEEN.Tween(Option)
                            .to({
                                hpy:56,
                                hsy:1,
                                hsx:1,
                                hsz:1,
                            }, 50)
                            .onUpdate(function() {
                                player.children[0].position.y = this.hpy;
                                player.children[1].scale.y = this.hsy;
                                player.children[1].scale.x = this.hsx;
                                player.children[1].scale.z = this.hsz;
                            })
            
            Option = { py:0,px:playerPosition.x,pz:playerPosition.z};
            jumpr2 = new TWEEN.Tween(Option)
                            .to({
                                py: [150, 0],
                                px: [playerPosition.x-playerMoveLen*0.5,playerPosition.x-playerMoveLen],
                                pz:[playerPosition.z*0.5,0],
                                // rz: [Math.PI, 0],
                            }, 400)
                            .onUpdate(function() {
                                player.position.y = this.py+50;
                                player.position.x = this.px;
                                player.position.z = this.pz;
                                
                            })
                            .onComplete(function() {
                                playerPosition.z = 0;
                                playerPosition.x = playerPosition.x -playerMoveLen;
                                if(-playerPosition.x-buildDistance<=50&&-playerPosition.x-buildDistance>=-50){
                                    // 下个盒子上
                                    pointGet();
                                    changeCamera();
                                    bulingBulingUp();
                                    // console.log("下个盒子上");
                                    
                                }
                                else if(-playerPosition.x<=50){
                                    //本盒子上
                                    bulingBulingUp();
                                    // console.log("本盒子上");
                                    
                                }
                                else if(-playerPosition.x>50&&-playerPosition.x<62){
                                    //本盒子边上掉落
                                    gameOver(11);
                                    // console.log("本盒子边上掉落");
                                }
                                else if(-playerPosition.x-buildDistance<62&&-playerPosition.x-buildDistance>50){
                                    //下个盒子远边上掉落
                                    gameOver(22);
                                    // console.log("下个盒子远边上掉落");
                                }
                                else if(-playerPosition.x-buildDistance>-38&&-playerPosition.x-buildDistance<-50){
                                    //下个盒子近边上掉落
                                    gameOver(21);
                                    // console.log("下个盒子近边上掉落");
                                }
                                else{
                                    //竖直下落
                                    gameOver(0);
                                    // console.log("竖直下落");
                                }
                            
                            })  
                            .interpolation( TWEEN.Interpolation.Bezier )
            jumpr1.chain(jumpr2);
            jumpr1.start(); 
        }       

    }

    function bulingBulingDown() {    
    }

    function bulingBulingUp() {    
    }

    function changeCamera() { 
        var directionFlog = direction;
        if (directionFlog == 1) {
            playerPosition.z = player.position.z;
            if(mainmesh1&&mainmesh2&&mainmesh3&&mainmesh4&&mainmesh5){
                // console.log(mainmeshPosition1,mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                Option = {pz:playerPosition.z,ps1:mainmeshPosition1.z,ps2:mainmeshPosition2.z,ps3:mainmeshPosition3.z,ps4:mainmeshPosition4.z,ps5:mainmeshPosition5.z};
                new TWEEN.Tween(Option)
                        .to({
                            pz: playerPosition.z+buildDistance,
                            ps1: mainmeshPosition1.z+buildDistance,
                            ps2: mainmeshPosition2.z+buildDistance,
                            ps3: mainmeshPosition3.z+buildDistance,
                            ps4: mainmeshPosition4.z+buildDistance,
                            ps5: mainmeshPosition5.z+buildDistance,
                        }, 400)
                        .onUpdate(function() {
                            mainmesh1.position.z = this.ps1;
                            mainmesh2.position.z = this.ps2;
                            mainmesh3.position.z = this.ps3;
                            mainmesh4.position.z = this.ps4;
                            mainmesh5.position.z = this.ps5;
                            player.position.z =this.pz;                                       
                        })
                        .onComplete(function() {
                            playerPosition.z +=buildDistance;
                            mainmeshPosition1.z =mainmeshPosition2.z+buildDistance;
                            mainmeshPosition1.x =mainmeshPosition2.x;
                            mainmeshPosition2.z =mainmeshPosition3.z+buildDistance;
                            mainmeshPosition2.x =mainmeshPosition3.x;
                            mainmeshPosition3.z =mainmeshPosition4.z+buildDistance;
                            mainmeshPosition3.x =mainmeshPosition4.x;
                            mainmeshPosition4.z =mainmeshPosition5.z+buildDistance;
                            mainmeshPosition4.x =mainmeshPosition5.x;
                            deleteGroup(mainmesh1);
                            mainmesh1 = mainmesh2;
                            mainmesh2 = mainmesh3;
                            mainmesh3 = mainmesh4;
                            mainmesh4 = mainmesh5;
                            createBox();
                            // console.log(mainmeshPosition1,mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                        })
                        .start();
            }
            else if (!mainmesh3){
                // console.log(mainmeshPosition4,mainmeshPosition5);
                Option = {pz:playerPosition.z,ps4:mainmeshPosition4.z,ps5:mainmeshPosition5.z};
                new TWEEN.Tween(Option)
                        .to({
                            pz: playerPosition.z+buildDistance,
                            ps4: mainmeshPosition4.z+buildDistance,
                            ps5: mainmeshPosition5.z+buildDistance,
                        }, 400)
                        .onUpdate(function() {
                            mainmesh4.position.z = this.ps4;
                            mainmesh5.position.z = this.ps5;
                            player.position.z =this.pz;                                       
                        })
                        .onComplete(function() {
                            playerPosition.z +=buildDistance;
                            mainmeshPosition3= new THREE.Vector3(0,0,0);
                            mainmeshPosition3.z =mainmeshPosition4.z+buildDistance;
                            mainmeshPosition3.x =mainmeshPosition4.x;
                            mainmeshPosition4.z =mainmeshPosition5.z+buildDistance;
                            mainmeshPosition4.x =mainmeshPosition5.x;
                            mainmesh3 = mainmesh4;
                            mainmesh4 = mainmesh5;
                            createBox();
                            // console.log(mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                        })
                        .start();
                
            }
            else if (!mainmesh2){
                // console.log(mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                Option = {pz:playerPosition.z,ps3:mainmeshPosition3.z,ps4:mainmeshPosition4.z,ps5:mainmeshPosition5.z};
                new TWEEN.Tween(Option)
                        .to({
                            pz: playerPosition.z+buildDistance,
                            ps3: mainmeshPosition3.z+buildDistance,
                            ps4: mainmeshPosition4.z+buildDistance,
                            ps5: mainmeshPosition5.z+buildDistance,
                        }, 400)
                        .onUpdate(function() {
                            mainmesh3.position.z = this.ps3;
                            mainmesh4.position.z = this.ps4;
                            mainmesh5.position.z = this.ps5;
                            player.position.z =this.pz;                                       
                        })
                        .onComplete(function() {
                            playerPosition.z +=buildDistance;
                            mainmeshPosition2= new THREE.Vector3(0,0,0);
                            mainmeshPosition2.z =mainmeshPosition3.z+buildDistance;
                            mainmeshPosition2.x =mainmeshPosition3.x;
                            mainmeshPosition3.z =mainmeshPosition4.z+buildDistance;
                            mainmeshPosition3.x =mainmeshPosition4.x;
                            mainmeshPosition4.z =mainmeshPosition5.z+buildDistance;
                            mainmeshPosition4.x =mainmeshPosition5.x;
                            mainmesh2 = mainmesh3;
                            mainmesh3 = mainmesh4;
                            mainmesh4 = mainmesh5;
                            createBox();
                            // console.log(mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                        })
                        .start();
            }
            else{
                // console.log(mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                Option = {pz:playerPosition.z,ps2:mainmeshPosition2.z,ps3:mainmeshPosition3.z,ps4:mainmeshPosition4.z,ps5:mainmeshPosition5.z};
                new TWEEN.Tween(Option)
                        .to({
                            pz: playerPosition.z+buildDistance,
                            ps2: mainmeshPosition2.z+buildDistance,
                            ps3: mainmeshPosition3.z+buildDistance,
                            ps4: mainmeshPosition4.z+buildDistance,
                            ps5: mainmeshPosition5.z+buildDistance,
                        }, 400)
                        .onUpdate(function() {
                            mainmesh2.position.z = this.ps2;
                            mainmesh3.position.z = this.ps3;
                            mainmesh4.position.z = this.ps4;
                            mainmesh5.position.z = this.ps5;
                            player.position.z =this.pz;                                       
                        })
                        .onComplete(function() {
                            playerPosition.z +=buildDistance;
                            mainmeshPosition1= new THREE.Vector3(0,0,0);
                            mainmeshPosition1.z =mainmeshPosition2.z+buildDistance;
                            mainmeshPosition1.x =mainmeshPosition2.x;
                            mainmeshPosition2.z =mainmeshPosition3.z+buildDistance;
                            mainmeshPosition2.x =mainmeshPosition3.x;
                            mainmeshPosition3.z =mainmeshPosition4.z+buildDistance;
                            mainmeshPosition3.x =mainmeshPosition4.x;
                            mainmeshPosition4.z =mainmeshPosition5.z+buildDistance;
                            mainmeshPosition4.x =mainmeshPosition5.x;
                            mainmesh1 = mainmesh2;
                            mainmesh2 = mainmesh3;
                            mainmesh3 = mainmesh4;
                            mainmesh4 = mainmesh5;
                            createBox();
                            // console.log(mainmeshPosition1,mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                        })
                        .start();
            }
        }
        else {
            playerPosition.x = player.position.x;
            if(mainmesh1&&mainmesh2&&mainmesh3&&mainmesh4&&mainmesh5){
                // console.log(mainmeshPosition1,mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                Option = {px:playerPosition.x,ps1:mainmeshPosition1.x,ps2:mainmeshPosition2.x,ps3:mainmeshPosition3.x,ps4:mainmeshPosition4.x,ps5:mainmeshPosition5.x};
                new TWEEN.Tween(Option)
                        .to({
                            px: playerPosition.x+buildDistance,
                            ps1: mainmeshPosition1.x+buildDistance,
                            ps2: mainmeshPosition2.x+buildDistance,
                            ps3: mainmeshPosition3.x+buildDistance,
                            ps4: mainmeshPosition4.x+buildDistance,
                            ps5: mainmeshPosition5.x+buildDistance,
                        }, 400)
                        .onUpdate(function() {
                            mainmesh1.position.x = this.ps1;
                            mainmesh2.position.x = this.ps2;
                            mainmesh3.position.x = this.ps3;
                            mainmesh4.position.x = this.ps4;
                            mainmesh5.position.x = this.ps5;
                            player.position.x =this.px;                                       
                        })
                        .onComplete(function() {
                            playerPosition.x +=buildDistance;
                            mainmeshPosition1.x =mainmeshPosition2.x+buildDistance;
                            mainmeshPosition1.z =mainmeshPosition2.z;
                            mainmeshPosition2.x =mainmeshPosition3.x+buildDistance;
                            mainmeshPosition2.z =mainmeshPosition3.z;
                            mainmeshPosition3.x =mainmeshPosition4.x+buildDistance;
                            mainmeshPosition3.z =mainmeshPosition4.z;
                            mainmeshPosition4.x =mainmeshPosition5.x+buildDistance;
                            mainmeshPosition4.z =mainmeshPosition5.z;
                            deleteGroup(mainmesh1);
                            mainmesh1 = mainmesh2;
                            mainmesh2 = mainmesh3;
                            mainmesh3 = mainmesh4;
                            mainmesh4 = mainmesh5;
                            createBox();
                            // console.log(mainmeshPosition1,mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                        })
                        .start();
            }
            else if (!mainmesh3){
                // console.log(mainmeshPosition4,mainmeshPosition5);
                Option = {px:playerPosition.x,ps4:mainmeshPosition4.x,ps5:mainmeshPosition5.x};
                new TWEEN.Tween(Option)
                        .to({
                            px: playerPosition.x+buildDistance,
                            ps4: mainmeshPosition4.x+buildDistance,
                            ps5: mainmeshPosition5.x+buildDistance,
                        }, 400)
                        .onUpdate(function() {
                            mainmesh4.position.x = this.ps4;
                            mainmesh5.position.x = this.ps5;
                            player.position.x = this.px;                                       
                        })
                        .onComplete(function() {
                            playerPosition.x +=buildDistance;
                            mainmeshPosition3= new THREE.Vector3(0,0,0);
                            mainmeshPosition3.x =mainmeshPosition4.x+buildDistance;
                            mainmeshPosition3.z =mainmeshPosition4.z;
                            mainmeshPosition4.x =mainmeshPosition5.x+buildDistance;
                            mainmeshPosition4.z =mainmeshPosition5.z;
                            mainmesh3 = mainmesh4;
                            mainmesh4 = mainmesh5;
                            createBox();
                            // console.log(mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                        })
                        .start();
                
            }
            else if (!mainmesh2){
                // console.log(mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                Option = {px:playerPosition.x,ps3:mainmeshPosition3.x,ps4:mainmeshPosition4.x,ps5:mainmeshPosition5.x};
                new TWEEN.Tween(Option)
                        .to({
                            px: playerPosition.x+buildDistance,
                            ps3: mainmeshPosition3.x+buildDistance,
                            ps4: mainmeshPosition4.x+buildDistance,
                            ps5: mainmeshPosition5.x+buildDistance,
                        }, 400)
                        .onUpdate(function() {
                            mainmesh3.position.x = this.ps3;
                            mainmesh4.position.x = this.ps4;
                            mainmesh5.position.x = this.ps5;
                            player.position.x =this.px;                                       
                        })
                        .onComplete(function() {
                            playerPosition.x +=buildDistance;
                            mainmeshPosition2= new THREE.Vector3(0,0,0);
                            mainmeshPosition2.x =mainmeshPosition3.x+buildDistance;
                            mainmeshPosition2.z =mainmeshPosition3.z;
                            mainmeshPosition3.x =mainmeshPosition4.x+buildDistance;
                            mainmeshPosition3.z =mainmeshPosition4.z;
                            mainmeshPosition4.x =mainmeshPosition5.x+buildDistance;
                            mainmeshPosition4.z =mainmeshPosition5.z;
                            mainmesh2 = mainmesh3;
                            mainmesh3 = mainmesh4;
                            mainmesh4 = mainmesh5;
                            createBox();
                            // console.log(mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                        })
                        .start();
            }
            else{
                // console.log(mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                Option = {px:playerPosition.x,ps2:mainmeshPosition2.x,ps3:mainmeshPosition3.x,ps4:mainmeshPosition4.x,ps5:mainmeshPosition5.x};
                new TWEEN.Tween(Option)
                        .to({
                            px: playerPosition.x+buildDistance,
                            ps2: mainmeshPosition2.x+buildDistance,
                            ps3: mainmeshPosition3.x+buildDistance,
                            ps4: mainmeshPosition4.x+buildDistance,
                            ps5: mainmeshPosition5.x+buildDistance,
                        }, 400)
                        .onUpdate(function() {
                            mainmesh2.position.x = this.ps2;
                            mainmesh3.position.x = this.ps3;
                            mainmesh4.position.x = this.ps4;
                            mainmesh5.position.x = this.ps5;
                            player.position.x =this.px;                                       
                        })
                        .onComplete(function() {
                            playerPosition.x +=buildDistance;
                            mainmeshPosition1= new THREE.Vector3(0,0,0);
                            mainmeshPosition1.x =mainmeshPosition2.x+buildDistance;
                            mainmeshPosition1.z =mainmeshPosition2.z;
                            mainmeshPosition2.x =mainmeshPosition3.x+buildDistance;
                            mainmeshPosition2.z =mainmeshPosition3.z;
                            mainmeshPosition3.x =mainmeshPosition4.x+buildDistance;
                            mainmeshPosition3.z =mainmeshPosition4.z;
                            mainmeshPosition4.x =mainmeshPosition5.x+buildDistance;
                            mainmeshPosition4.z =mainmeshPosition5.z;
                            mainmesh1 = mainmesh2;
                            mainmesh2 = mainmesh3;
                            mainmesh3 = mainmesh4;
                            mainmesh4 = mainmesh5;
                            createBox();
                            // console.log(mainmeshPosition1,mainmeshPosition2,mainmeshPosition3,mainmeshPosition4,mainmeshPosition5);
                        })
                        .start();
            }
        }
    }

    var createCount = 0;
    function createBox() {  
        createCount += 1;
        var boxCount = 28;
        var boxNum = Math.floor(Math.random()*boxCount); //0~boxCount-1
        direction = Math.floor(Math.random()*2); //0~boxCount-1
        buildDistance = 100+(1+Math.floor(Math.random()*7))*20; //140~380
        // 第五个生成红包 后面没过是个固定生成
        if ((createCount + 5 ) % 10 ===0) {
            boxNum = 18; // 生成红包盒子
        }
        if (direction == 1){
            switch(boxNum)
            {
                case 0:mainmesh5 = creatcube10(0,-buildDistance);break;
                case 1:mainmesh5 = creatcube11(0,-buildDistance);break;
                case 2:mainmesh5 = creatcube12(0,-buildDistance);break;
                case 3:mainmesh5 = creatcube13(0,-buildDistance);break;
                case 4:mainmesh5 = creatcube14(0,-buildDistance);break;
                case 5:mainmesh5 = creatcube15(0,-buildDistance);break;
                case 6:mainmesh5 = creatcube16(0,-buildDistance);break;
                case 7:mainmesh5 = creatcube17(0,-buildDistance);break;
                case 8:mainmesh5 = creatcube18(0,-buildDistance);break;
                case 9:mainmesh5 = creatcube21(0,-buildDistance);break;
                case 10:mainmesh5 = creatcube22(0,-buildDistance);break;
                case 11:mainmesh5 = creatcube23(0,-buildDistance);break;
                case 12:mainmesh5 = creatcube24(0,-buildDistance);break;
                case 13:mainmesh5 = creatcube25(0,-buildDistance);break;
                case 14:mainmesh5 = creatcube26(0,-buildDistance);break;
                case 15:mainmesh5 = creatcube27(0,-buildDistance);break;
                case 16:mainmesh5 = creatcube01(0,-buildDistance);break;
                case 17:mainmesh5 = creatcube02(0,-buildDistance);break;
                case 18:mainmesh5 = creatcube03(0,-buildDistance);break;
                case 19:mainmesh5 = creatcube04(0,-buildDistance);break;
                case 20:mainmesh5 = creatcube05(0,-buildDistance);break;
                case 21:mainmesh5 = creatcube06(0,-buildDistance);break;
                case 22:mainmesh5 = creatcube07(0,-buildDistance);break;
                case 23:mainmesh5 = creatdesk(0,-buildDistance);break;
                case 24:mainmesh5 = creatdesk2(0,-buildDistance);break;
                case 25:mainmesh5 = creatcylinder(0,-buildDistance);break;
                case 26:mainmesh5 = creatcylinder2(0,-buildDistance);break;
                case 27:mainmesh5 = creatcup(0,-buildDistance);break;
            } 
            mainmesh5.position.set(0,100,0);
            mainmeshPosition5.z = 0;
            new TWEEN.Tween(mainmesh5.position)
                            .to({
                                y: 0,
                            },500)
                            .easing(TWEEN.Easing.Bounce.Out) 
                            .start();
        }
        else {
            switch(boxNum)
            {
                case 0:mainmesh5 = creatcube10(-buildDistance,0);break;
                case 1:mainmesh5 = creatcube11(-buildDistance,0);break;
                case 2:mainmesh5 = creatcube12(-buildDistance,0);break;
                case 3:mainmesh5 = creatcube13(-buildDistance,0);break;
                case 4:mainmesh5 = creatcube14(-buildDistance,0);break;
                case 5:mainmesh5 = creatcube15(-buildDistance,0);break;
                case 6:mainmesh5 = creatcube16(-buildDistance,0);break;
                case 7:mainmesh5 = creatcube17(-buildDistance,0);break;
                case 8:mainmesh5 = creatcube18(-buildDistance,0);break;
                case 9:mainmesh5 = creatcube21(-buildDistance,0);break;
                case 10:mainmesh5 = creatcube22(-buildDistance,0);break;
                case 11:mainmesh5 = creatcube23(-buildDistance,0);break;
                case 12:mainmesh5 = creatcube24(-buildDistance,0);break;
                case 13:mainmesh5 = creatcube25(-buildDistance,0);break;
                case 14:mainmesh5 = creatcube26(-buildDistance,0);break;
                case 15:mainmesh5 = creatcube27(-buildDistance,0);break;
                case 16:mainmesh5 = creatcube01(-buildDistance,0);break;
                case 17:mainmesh5 = creatcube02(-buildDistance,0);break;
                case 18:mainmesh5 = creatcube03(-buildDistance,0);break;
                case 19:mainmesh5 = creatcube04(-buildDistance,0);break;
                case 20:mainmesh5 = creatcube05(-buildDistance,0);break;
                case 21:mainmesh5 = creatcube06(-buildDistance,0);break;
                case 22:mainmesh5 = creatcube07(-buildDistance,0);break;
                case 23:mainmesh5 = creatdesk(-buildDistance,0);break;
                case 24:mainmesh5 = creatdesk2(-buildDistance,0);break;
                case 25:mainmesh5 = creatcylinder(-buildDistance,0);break;
                case 26:mainmesh5 = creatcylinder2(-buildDistance,0);break;
                case 27:mainmesh5 = creatcup(-buildDistance,0);break;
            } 
            mainmesh5.position.set(0,100,0);
            mainmeshPosition5.x = 0;
            new TWEEN.Tween(mainmesh5.position)
                            .to({
                                y: 0,
                            },500)
                            .easing(TWEEN.Easing.Bounce.Out) 
                            .start();
        }
    }

    function gameOver(flog) {  

        switch(flog){
            case 0:downTween0();break;
            case 11:downTween11();break;
            case 21:downTween21();break;
            case 22:downTween22();break;
            case 12:downTween12();break;
            case 23:downTween23();break;
            case 24:downTween24();break;
        }
        function downTween0() {    
        }
        function downTween11() {    
        }
        function downTween21() {    
        }
        function downTween22() {    
        }
        function downTween12() {    
        }
        function downTween23() {    
        }
        function downTween24() {    
        }
        pointCount();

    }

    function saveHistory() {
        var historyHighest = getHistoryHighest();
        if (point > historyHighest) {
            setHistoryHighest(point);
            historyHighest = point;
            document.getElementById("normal_score").style.display = "none";
            document.getElementById("new_score").style.display = "block";
        }
        document.getElementById("history_highest").innerHTML = historyHighest || 0;

    }

    function pointCount() {
        saveHistory();
        document.getElementById("gameOver").style.display = "block";
        document.getElementById("point").style.display = "none";
    }

    function pointGet() { 
        if (direction == 1) {
            if (playerPosition.z-buildDistance==0){
                point += 2;
            }
            else{
                point += 1;
            }
        }
        else {
            if (playerPosition.x-buildDistance==0){
                point += 2;
            }
            else{
                point += 1;
            }
        }
        
            // document.getElementById('audio').play()
        // console.log(point);
        document.getElementById("point").innerHTML=point;
        document.getElementById("pointtotal").innerHTML=point;
        console.log(mainmesh5.luckyType, 'mainmesh5')
        if (mainmesh5.luckyType === LUCKY_TYPE.MONEY) {
            showLuckPopup();
        } else if (mainmesh5.luckyType === LUCKY_TYPE.RECORD) {
            // showLuckPopup();
            var audioEl = document.getElementById('audio');
            var srcs = ['./source/make-it-happen.mp3', './source/meeting-point.mp3', './source/in-your-hands.mp3', './source/spiritual.mp3']
            audioEl.src = srcs[Math.floor(Math.random() * srcs.length)];
            audioEl.volumevalue = 0.3;
            audioEl.play();

            // TODO:小彩蛋
        } else {
            var audioEl = document.getElementById('audio');
            audioEl.src = './source/jump.mp3';
            audioEl.volumevalue = 0.3;
            audioEl.play();
        }
    }

    function onWindowResize() {
        width = document.getElementById('canvas-frame').clientWidth;
        // height = document.getElementById('canvas-frame').clientHeight;
        camera.left = width / - 2;
        camera.right = width /  2
        camera.updateProjectionMatrix();
        renderer.setSize( width,height );
    }

    function animate() {
        requestAnimationFrame( animate );
        stats.update();
        TWEEN.update();
        // controls.update();
        render();
    }

    function render() {
        renderer.render( scene, camera );
    }

    function replay() {
        location.reload();
    }

    function revive() {
        pointGet();
        changeCamera();
        bulingBulingUp();

        var Option = { py: player.position.y + 200 };
        new TWEEN.Tween(Option)
                        .to({
                            py: 50,
                        },500)
                        .onUpdate(function() {
                            player.position.y = this.py;
                            player.position.x = 0;
                            player.position.z = 0;
                            playerPosition.x = 0;
                            playerPosition.z = 0;
                        })
                        .easing(TWEEN.Easing.Bounce.Out) 
                        .delay(500)
                        .start();   

        document.getElementById("gameOver").style.display = "none";
        document.getElementById("point").style.display = "block";
    }

    var videoModel;

    function playHandle() {
        var srcs = ['./source/video1.mp4', './source/video2.mp4']
        var videoModel = new VideoModel({ 
            src: srcs[Math.floor(Math.random() * srcs.length)],
        });
        videoModel.playStart()
        // revive()
    }


    function showLuckPopup() {
        document.getElementById('locky_box').style.display = 'block';
    }

    function hideLockPopup() {
        document.getElementById('locky_box').style.display = 'none';
    }


</script>

<body onload="threeStart();">
<audio id="audio" src="./source/make-it-happen.mp3"></audio>
<div id="canvas-frame" ></div>
<!-- <div style="color: red; position: fixed;z-index: 99999;top: 20%;left: 50%;font-size: 50px;">2121212121</div> -->
<div id="point"> 0 </div>
<div id="gameOver" >
    <!-- 本次得分: pontuação desta vez -->
    <p id="normal_score"  style="font-size:0.5rem; margin-top:100px;font-weight: 200; ">pontuação desta vez</p>
    <!-- 新纪录: novo recorde -->
    <p id="new_score" style="font-size:0.5rem; margin-top:100px;font-weight: 200;display: none; ">= <span style="color: #f53c00">novo recorde</span> =</p>
    <p style="font-size:2rem; font-weight: bold; margin-top:20px; font-family: numjump;" id= "pointtotal" >0</p>
    <!-- 看广告复活: assista anúncio para reviver -->
    <button style="margin-top: 75%;" class="start-btn" onclick="playHandle();">
        Veja o anúncio reviver
    </button>
    <button style="margin-top: 60px;" class="start-btn" onclick="replay();">
        <!-- 再玩一局: jogar novamente -->
        jogar novamente
    </button>
    <!-- 历史最高得分: pontuação mais alta da história -->
    <p style="font-size:0.4rem; margin-top:100px;font-weight: 200; ">pontuação mais alta da história: <span id="history_highest">0</span></p>

    <!-- <img style="margin-top:80px;width:160px;height:60px;" src="source/bottom.png"  onclick="replay();"> -->
</div>
<div class="video-box" id="video_box" style="display: none;">
    <div class="video-box-top">
        <div class="top-left video-radius">
            <!-- 广告: anúncio/publicidade -->
            <span class="margin-em">pub</span>
            <span style="margin-bottom: 3px;">|</span>
            <span class="margin-em" id="ad_tips1">
                <span id="countdown">25</span>s recompensa disponível</span>
                <!-- 可获得奖励: recompensa disponível -->
                <!-- 已获得奖励: recompensa obtida -->
            <span style="display: none;" class="margin-em" id="ad_tips2">recompensa obtida</span>
        </div>
        <div class="top-right video-radius">
            <img class="radio-img" id="muted" src="./source/muted.png" alt="" srcset="">
            <img  style="display: none;"  class="radio-img" id="notice" src="./source/notice.png" alt="" srcset="">
            <span style="margin-bottom: 3px;">|</span>
            <!-- 关闭: fechar -->
            <span id='close_btn' class="margin-em">fechar</span>
        </div>
    </div>
    <div class="video-center" onclick="gotoOutLink()">
        <video muted class="video-index" id="video_id" src="./source/video1.mp4"></video>
    </div>
    <div class="card-download" id="card_download">
        <img class="card-download-logo" src="./source/24trade-logo1.png" alt="">
        <div class="card-download-info">
            <div class="card-download-title">24pro Trade</div>
            <!-- 投资不需要大量资金。: Investir não requer uma grande quantidade de capital. -->
            <div>Investir não requer uma grande quantidade de capital.</div>
        </div>
        <div onclick="gotoOutLink()" class="card-download-btn">
            <!-- 立即下载: baixar agora -->
            baixar agora
        </div>
    </div>
    <div class="card-download1" id="card_download1">
        <img class="card-download-logo" src="./source/24trade-logo1.png" alt="">
        <div class="card-download-info">
            <div class="card-download-title">24pro Trade</div>
            <div>Investir não requer uma grande quantidade de capital.</div>
        </div>
        <div onclick="gotoOutLink()" class="card-download-btn">
            baixar agora
        </div>
    </div>
</div>
<div class="popup" id="popup_box" style="display: none;">
    <div class="popup-mark"></div>
    <!-- 暂未获得奖励: recompensa ainda não obtida
是否继续观看视频: continuar assistindo o vídeo?
放弃: desistir
继续: continuar -->
    <div class="popup-content">
        <div class="popup-content-body">
            <p>recompensa ainda não obtida</p>
            <p>continuar assistindo o vídeo?</p>
        </div>
        <div class="popup-content-footer">
            <div id="give_up" class="popup-content-footer-btn">desistir</div>
            <div id="continue" class="popup-content-footer-btn">continuar</div>
        </div>
    </div>
</div>
<div class="lucky-box" id="locky_box" style="display: none;">
    <div class="lucky-box-musk"></div>
    <div class="lucky-box-content">
        <img class="b-img" src="./source/card.png" alt="card" />
        <div class="lucky-box-content-body">
            <div>
                <div class="top-text">Obter bônus em dinheiro</div>
                <div class="center-text">
                    <span class="text1">R$</span>
                    <span class="text2">68</span>
                    <span class="text3">Máximo</span>
                </div>
                <div class="bottom-text">
                    Tempo efetivo：10 min
                </div>
            </div>
            <button
                marginTop="32px"
                class="btn"
                onclick="gotoOutLink()"
            >
                <img
                    class="btn-img"
                    src="./source/card-btn.png"
                    alt="btn"
                />
                <div class="btn-text">
                    Faça login para receber
                </div>
            </button>
            <div>
                <img
                    onclick="hideLockPopup()"
                    class="close-img"
                    src="./source/close-btn.png"
                    alt="">
            </div>
        </div>
      </div>
</div>
<!-- <canvas style="position: absolute; top: 0;left: 0;z-index: 999;width: 100%;height: 100%;">

</canvas> -->
<!-- <div id="test" style="position: absolute; top: 0;left: 0;z-index: 999;width: 100%;height: 100%;" >

</div> -->
</body>
</html>

